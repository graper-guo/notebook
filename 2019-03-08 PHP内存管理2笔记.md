# **2019-03-08 PHP内存管理2笔记**
视频地址：http://replay.xesv5.com/ll/2480/92c4f2bfb31f013b2f3866d07bcac038.flv.mp4
## 复习
 - AG：alloc globals 全局变量
```c
typedef struct _zend_alloc_globals {
	zend_mm_heap *mm_heap;
} zend_alloc_globals;
...
# define AG(v) (alloc_globals.v)
static zend_alloc_globals alloc_globals;
```
这个带有参数的宏取得zend_alloc_globals里的zend_mm_heap结构体字段，如AG(mm_heap) = alloc_globals.mm_heap，宏就是替换。
## 结构体内存对齐
 - 核心：编译器做的优化，以空间换时间。**按照结构体占用空间最大的字段做对齐（最大是8B就按8B对齐；最大4B就按4B对齐），且和结构体字段的排列顺序是相关的**
![enter description here](http://pq370w15r.bkt.clouddn.com/notebook/2019/4/17/1555503078430.png)
 - 例：如果调换顺序，把b和c调换位置，就会变成8B(a)+8B(c)+8B(b)+8B(d)+8B(e)+8B(f) = 48B
## 联合体
 - 核心：所有联合体字段共用一块内存空间。整个联合体占用的空间是所有字段占用空间取最大值。